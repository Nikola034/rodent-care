<p-toast position="top-right"></p-toast>

<div class="rodent-form">
  <!-- Header -->
  <div class="flex align-items-center gap-3 mb-4">
    <p-button icon="pi pi-arrow-left" [rounded]="true" [text]="true" (onClick)="cancel()"></p-button>
    <div>
      <h1 class="text-2xl font-bold text-color m-0">{{ pageTitle }}</h1>
      @if (isEditMode && existingRodent) {
        <p class="text-color-secondary mt-1 mb-0">Editing {{ existingRodent.name }}</p>
      }
    </div>
  </div>

  @if (isLoading) {
    <div class="flex justify-content-center py-6">
      <p-progressSpinner></p-progressSpinner>
    </div>
  } @else {
    <form [formGroup]="rodentForm" (ngSubmit)="onSubmit()">
      <div class="grid">
        <!-- Basic Information -->
        <div class="col-12 lg:col-8">
          <p-card header="Basic Information">
            <div class="grid">
              <!-- Name -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="name" class="font-semibold">Name *</label>
                  <input pInputText id="name" formControlName="name" class="w-full"
                    [class.p-invalid]="isFieldInvalid('name')" placeholder="Enter rodent name" />
                  @if (isFieldInvalid('name')) {
                    <small class="p-error">{{ getFieldError('name') }}</small>
                  }
                </div>
              </div>

              <!-- Species -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="species" class="font-semibold">Species *</label>
                  <p-dropdown id="species" formControlName="species" [options]="speciesOptions"
                    placeholder="Select species" styleClass="w-full"
                    [class.p-invalid]="isFieldInvalid('species')"></p-dropdown>
                  @if (isFieldInvalid('species')) {
                    <small class="p-error">{{ getFieldError('species') }}</small>
                  }
                </div>
              </div>

              <!-- Gender -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="gender" class="font-semibold">Gender *</label>
                  <p-dropdown id="gender" formControlName="gender" [options]="genderOptions"
                    placeholder="Select gender" styleClass="w-full"
                    [class.p-invalid]="isFieldInvalid('gender')"></p-dropdown>
                  @if (isFieldInvalid('gender')) {
                    <small class="p-error">{{ getFieldError('gender') }}</small>
                  }
                </div>
              </div>

              <!-- Status -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="status" class="font-semibold">Status *</label>
                  <p-dropdown id="status" formControlName="status" [options]="statusOptions"
                    placeholder="Select status" styleClass="w-full" [disabled]="isEditMode"
                    [class.p-invalid]="isFieldInvalid('status')"></p-dropdown>
                  @if (isFieldInvalid('status')) {
                    <small class="p-error">{{ getFieldError('status') }}</small>
                  }
                  @if (isEditMode) {
                    <small class="text-color-secondary">Use the detail page to change status with a reason</small>
                  }
                </div>
              </div>

              <!-- Date of Birth -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="date_of_birth" class="font-semibold">Date of Birth</label>
                  <p-calendar id="date_of_birth" formControlName="date_of_birth" dateFormat="yy-mm-dd"
                    [showIcon]="true" [maxDate]="maxDate" styleClass="w-full" placeholder="Select date"></p-calendar>
                </div>
              </div>

              <!-- Date of Birth Estimated -->
              <div class="col-12 md:col-6">
                <div class="field flex align-items-end h-full pb-3">
                  <p-checkbox formControlName="date_of_birth_estimated" [binary]="true"
                    inputId="date_of_birth_estimated" label="Date of birth is estimated"></p-checkbox>
                </div>
              </div>

              <!-- Chip ID -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="chip_id" class="font-semibold">Chip ID</label>
                  <input pInputText id="chip_id" formControlName="chip_id" class="w-full"
                    placeholder="Enter microchip ID (optional)" />
                </div>
              </div>

              <!-- Intake Date -->
              <div class="col-12 md:col-6">
                <div class="field">
                  <label for="intake_date" class="font-semibold">Intake Date</label>
                  <p-calendar id="intake_date" formControlName="intake_date" dateFormat="yy-mm-dd"
                    [showIcon]="true" [maxDate]="maxDate" styleClass="w-full" [disabled]="isEditMode"></p-calendar>
                </div>
              </div>

              <!-- Notes -->
              <div class="col-12">
                <div class="field">
                  <label for="notes" class="font-semibold">Notes</label>
                  <textarea pInputTextarea id="notes" formControlName="notes" rows="4" class="w-full"
                    placeholder="Additional notes about the rodent..."></textarea>
                  <small class="text-color-secondary">Max 2000 characters</small>
                </div>
              </div>
            </div>
          </p-card>
        </div>

        <!-- Sidebar -->
        <div class="col-12 lg:col-4">
          <!-- Actions Card -->
          <p-card header="Actions" styleClass="mb-3">
            <div class="flex flex-column gap-2">
              <p-button label="{{ isEditMode ? 'Save Changes' : 'Create Rodent' }}" icon="pi pi-check"
                type="submit" [loading]="isSaving" styleClass="w-full"></p-button>
              <p-button label="Cancel" icon="pi pi-times" [outlined]="true" (onClick)="cancel()"
                [disabled]="isSaving" styleClass="w-full"></p-button>
            </div>
          </p-card>

          <!-- Tips Card -->
          <p-card header="Tips">
            <ul class="list-none p-0 m-0">
              <li class="flex align-items-start gap-2 mb-2">
                <i class="pi pi-info-circle text-primary mt-1"></i>
                <span class="text-sm">Fields marked with * are required</span>
              </li>
              <li class="flex align-items-start gap-2 mb-2">
                <i class="pi pi-info-circle text-primary mt-1"></i>
                <span class="text-sm">If you don't know the exact birth date, check "estimated"</span>
              </li>
              <li class="flex align-items-start gap-2">
                <i class="pi pi-info-circle text-primary mt-1"></i>
                <span class="text-sm">You can add images after creating the rodent</span>
              </li>
            </ul>
          </p-card>
        </div>
      </div>
    </form>
  }
</div>
